# Generated by Django 3.2.25 on 2025-12-17 11:21

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='ApprovalWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('resource_type', models.CharField(help_text="Resource type (e.g., 'campaign', 'program')", max_length=100)),
                ('steps', models.JSONField(default=list, help_text='List of approval steps')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('actor_id', models.CharField(blank=True, max_length=100, null=True)),
                ('action', models.CharField(max_length=100)),
                ('object_type', models.CharField(max_length=100)),
                ('object_id', models.CharField(max_length=100)),
                ('changes', models.TextField(blank=True)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='Badge',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('icon_url', models.URLField(blank=True)),
                ('requirements', models.JSONField(default=dict, help_text='Badge requirements')),
                ('rarity', models.CharField(choices=[('common', 'Common'), ('rare', 'Rare'), ('epic', 'Epic'), ('legendary', 'Legendary')], default='common', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='Campaign',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending_review', 'Pending Review'), ('approved', 'Approved'), ('active', 'Active'), ('paused', 'Paused'), ('retired', 'Retired')], default='draft', max_length=20)),
                ('eligibility_rules', models.JSONField(blank=True, default=dict, help_text='JSONLogic eligibility rules')),
                ('start_date', models.DateTimeField(blank=True, null=True)),
                ('end_date', models.DateTimeField(blank=True, null=True)),
                ('event_triggers', models.JSONField(blank=True, default=list, help_text='Kafka event triggers')),
                ('schedule_triggers', models.JSONField(blank=True, default=list, help_text='Schedule-based triggers')),
                ('threshold_triggers', models.JSONField(blank=True, default=list, help_text='Threshold-based triggers')),
                ('channels', models.JSONField(blank=True, default=list, help_text="['sms', 'email', 'push', 'in_app']")),
                ('frequency_cap', models.PositiveIntegerField(default=0, help_text='0 = unlimited')),
                ('frequency_period', models.CharField(choices=[('day', 'Day'), ('week', 'Week'), ('month', 'Month')], default='day', max_length=20)),
                ('version', models.PositiveIntegerField(default=1)),
                ('created_by', models.CharField(blank=True, max_length=100)),
                ('approved_by', models.CharField(blank=True, max_length=100, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Experiment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('variants', models.JSONField(default=list, help_text="List of variants: [{'name': 'A', 'weight': 50}, ...]")),
                ('start_date', models.DateTimeField()),
                ('end_date', models.DateTimeField()),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('running', 'Running'), ('paused', 'Paused'), ('completed', 'Completed')], default='draft', max_length=20)),
                ('success_metrics', models.JSONField(default=list, help_text='Metrics to track')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='Journey',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('entry_rules', models.JSONField(blank=True, default=dict)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='Leaderboard',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('ranking_criteria', models.CharField(choices=[('points_balance', 'Points Balance'), ('points_earned', 'Points Earned'), ('points_burned', 'Points Burned'), ('redemptions', 'Redemptions Count'), ('custom', 'Custom')], max_length=50)),
                ('period', models.CharField(choices=[('all_time', 'All Time'), ('monthly', 'Monthly'), ('weekly', 'Weekly'), ('daily', 'Daily')], default='all_time', max_length=20)),
                ('top_n', models.PositiveIntegerField(default=100)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyAccount',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('points_balance', models.IntegerField(default=0)),
                ('status', models.CharField(default='active', max_length=50)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyProgram',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('start_date', models.DateTimeField()),
                ('end_date', models.DateTimeField()),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyReward',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('points_required', models.PositiveIntegerField()),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rewards', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='Mission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('mission_type', models.CharField(choices=[('points_earn', 'Earn Points'), ('points_burn', 'Burn Points'), ('transaction_count', 'Transaction Count'), ('streak', 'Streak'), ('custom', 'Custom')], max_length=50)),
                ('objective', models.JSONField(default=dict, help_text="Mission objectives (e.g., {'points': 100, 'period': 'week'})")),
                ('reward_points', models.PositiveIntegerField(default=0)),
                ('start_date', models.DateTimeField()),
                ('end_date', models.DateTimeField()),
                ('is_active', models.BooleanField(default=True)),
                ('eligibility_rules', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='missions', to='loyalty.loyaltyprogram')),
                ('reward_badge', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='loyalty.badge')),
            ],
        ),
        migrations.CreateModel(
            name='Partner',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('partner_type', models.CharField(choices=[('coalition', 'Coalition Partner'), ('merchant', 'Merchant Partner'), ('affiliate', 'Affiliate')], max_length=50)),
                ('contact_email', models.EmailField(blank=True, max_length=254)),
                ('contact_phone', models.CharField(blank=True, max_length=50)),
                ('settlement_frequency', models.CharField(choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('monthly', 'Monthly')], default='monthly', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='Permission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField(blank=True)),
                ('resource', models.CharField(help_text="Resource name (e.g., 'campaign', 'program')", max_length=100)),
                ('action', models.CharField(help_text="Action (e.g., 'create', 'update', 'delete', 'view')", max_length=50)),
            ],
        ),
        migrations.CreateModel(
            name='Recommendation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('recommended_offering', models.CharField(max_length=255)),
                ('reason', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='Role',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField(blank=True)),
                ('role_type', models.CharField(choices=[('marketing', 'Marketing'), ('loyalty_ops', 'Loyalty Operations'), ('analyst', 'Analyst'), ('customer_care', 'Customer Care'), ('admin', 'Administrator')], max_length=50)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='Segment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('rules', models.JSONField(default=list, help_text='List of JSONLogic rules')),
                ('is_dynamic', models.BooleanField(default=True, help_text='Dynamic segments recalculate automatically')),
                ('is_rfm', models.BooleanField(default=False)),
                ('rfm_config', models.JSONField(blank=True, default=dict, help_text='RFM configuration')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_calculated_at', models.DateTimeField(blank=True, null=True)),
                ('program', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='segments', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='UserRole',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('user_id', models.CharField(db_index=True, max_length=100)),
                ('assigned_at', models.DateTimeField(auto_now_add=True)),
                ('assigned_by', models.CharField(blank=True, max_length=100)),
                ('role', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='users', to='loyalty.role')),
            ],
        ),
        migrations.CreateModel(
            name='Streak',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('streak_type', models.CharField(choices=[('daily_login', 'Daily Login'), ('daily_usage', 'Daily Usage'), ('daily_transaction', 'Daily Transaction'), ('custom', 'Custom')], max_length=50)),
                ('current_streak', models.PositiveIntegerField(default=0)),
                ('longest_streak', models.PositiveIntegerField(default=0)),
                ('last_activity_date', models.DateField(blank=True, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='streaks', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='SegmentSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('snapshot_date', models.DateTimeField()),
                ('member_count', models.PositiveIntegerField()),
                ('member_ids', models.JSONField(default=list, help_text='List of customer_ids at snapshot time')),
                ('segment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='snapshots', to='loyalty.segment')),
            ],
        ),
        migrations.CreateModel(
            name='SegmentMember',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('joined_at', models.DateTimeField(auto_now_add=True)),
                ('left_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('segment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='members', to='loyalty.segment')),
            ],
        ),
        migrations.CreateModel(
            name='RolePermission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('permission', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='roles', to='loyalty.permission')),
                ('role', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='permissions', to='loyalty.role')),
            ],
        ),
        migrations.CreateModel(
            name='Promotion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('start_date', models.DateTimeField()),
                ('end_date', models.DateTimeField()),
                ('is_active', models.BooleanField(default=True)),
                ('eligibility_criteria', models.TextField(blank=True, help_text='Describe eligibility or use JSON')),
                ('event_triggers', models.JSONField(blank=True, default=list, help_text="List of event triggers that activate this promotion. Format: [{'type': 'customer_login', 'conditions': {...}}, ...]")),
                ('trigger_frequency', models.CharField(choices=[('once', 'Once per customer'), ('daily', 'Once per day'), ('weekly', 'Once per week'), ('unlimited', 'Unlimited')], default='unlimited', help_text='How often this promotion can be triggered per customer', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('reward', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='promotions', to='loyalty.loyaltyreward')),
            ],
        ),
        migrations.CreateModel(
            name='PointsExpiryRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('expiry_period_days', models.PositiveIntegerField(help_text='Days until points expire')),
                ('expiry_type', models.CharField(choices=[('fifo', 'First In First Out'), ('lifo', 'Last In First Out'), ('proportional', 'Proportional')], default='fifo', max_length=20)),
                ('grace_period_days', models.PositiveIntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='expiry_rules', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='PointsExpiryEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('points_expired', models.PositiveIntegerField()),
                ('expiry_date', models.DateField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='expiry_events', to='loyalty.loyaltyaccount')),
                ('rule', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='events', to='loyalty.pointsexpiryrule')),
            ],
        ),
        migrations.CreateModel(
            name='PartnerSettlement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('period_start', models.DateTimeField()),
                ('period_end', models.DateTimeField()),
                ('total_points_earned', models.BigIntegerField(default=0)),
                ('total_points_burned', models.BigIntegerField(default=0)),
                ('settlement_amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('paid', 'Paid')], default='pending', max_length=20)),
                ('settlement_file', models.FileField(blank=True, null=True, upload_to='settlements/')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('partner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='settlements', to='loyalty.partner')),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='settlements', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='PartnerProgram',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('earn_rate', models.DecimalField(decimal_places=4, default=1.0, help_text='Points per unit', max_digits=10)),
                ('burn_rate', models.DecimalField(decimal_places=4, default=1.0, help_text='Units per point', max_digits=10)),
                ('settlement_rate', models.DecimalField(decimal_places=4, default=1.0, max_digits=10)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('partner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='programs', to='loyalty.partner')),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='partner_programs', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='MissionProgress',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('current_value', models.PositiveIntegerField(default=0)),
                ('target_value', models.PositiveIntegerField()),
                ('progress_percentage', models.FloatField(default=0.0)),
                ('is_completed', models.BooleanField(default=False)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('mission', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='progress', to='loyalty.mission')),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyTransaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('amount', models.IntegerField()),
                ('transaction_type', models.CharField(choices=[('earn', 'Earn'), ('redeem', 'Redeem'), ('adjust', 'Adjust')], max_length=50)),
                ('description', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='transactions', to='loyalty.loyaltyaccount')),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyTier',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('min_points', models.PositiveIntegerField(default=0)),
                ('benefits', models.TextField(blank=True)),
                ('priority', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tiers', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('rule_type', models.CharField(help_text='earn, redeem, tier, etc.', max_length=100)),
                ('logic', models.JSONField(help_text='JSONLogic expression')),
                ('value', models.CharField(blank=True, max_length=255)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rules', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyRedemption',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('points_used', models.PositiveIntegerField(default=0, help_text='Points used for this redemption. Auto-calculated from reward if 0.')),
                ('status', models.CharField(default='pending', max_length=50)),
                ('notes', models.TextField(blank=True, help_text='Additional notes for this redemption', null=True)),
                ('redemption_date', models.DateTimeField(auto_now_add=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='redemptions', to='loyalty.loyaltyaccount')),
                ('reward', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='redemptions', to='loyalty.loyaltyreward')),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('points_delta', models.IntegerField(default=0)),
                ('metadata', models.JSONField(blank=True, help_text='Additional event metadata', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('account', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='events', to='loyalty.loyaltyaccount')),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyEligibilityRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('logic', models.JSONField(help_text='JSONLogic expression for eligibility')),
                ('is_active', models.BooleanField(default=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='eligibility_rules', to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.CreateModel(
            name='LoyaltyEligibilityOverride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(unique=True)),
                ('force_eligible', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='loyalty.loyaltyprogram')),
            ],
        ),
        migrations.AddField(
            model_name='loyaltyaccount',
            name='program',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='accounts', to='loyalty.loyaltyprogram'),
        ),
        migrations.AddField(
            model_name='loyaltyaccount',
            name='tier',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='accounts', to='loyalty.loyaltytier'),
        ),
        migrations.CreateModel(
            name='LeaderboardEntry',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('rank', models.PositiveIntegerField()),
                ('score', models.FloatField()),
                ('period_start', models.DateTimeField()),
                ('period_end', models.DateTimeField()),
                ('calculated_at', models.DateTimeField(auto_now=True)),
                ('leaderboard', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='entries', to='loyalty.leaderboard')),
            ],
        ),
        migrations.AddField(
            model_name='leaderboard',
            name='program',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='leaderboards', to='loyalty.loyaltyprogram'),
        ),
        migrations.CreateModel(
            name='JourneyNode',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('node_type', models.CharField(choices=[('start', 'Start'), ('condition', 'Condition'), ('action', 'Action'), ('wait', 'Wait'), ('end', 'End')], max_length=20)),
                ('name', models.CharField(max_length=255)),
                ('config', models.JSONField(default=dict, help_text='Node-specific configuration')),
                ('position_x', models.FloatField(default=0)),
                ('position_y', models.FloatField(default=0)),
                ('order', models.PositiveIntegerField(default=0)),
                ('journey', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='nodes', to='loyalty.journey')),
            ],
        ),
        migrations.CreateModel(
            name='JourneyExecution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('status', models.CharField(choices=[('active', 'Active'), ('completed', 'Completed'), ('abandoned', 'Abandoned')], default='active', max_length=20)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('execution_data', models.JSONField(blank=True, default=dict)),
                ('current_node', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='loyalty.journeynode')),
                ('journey', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='executions', to='loyalty.journey')),
            ],
        ),
        migrations.CreateModel(
            name='JourneyEdge',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('condition', models.JSONField(blank=True, default=dict, help_text='Edge condition (JSONLogic)')),
                ('from_node', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='outgoing_edges', to='loyalty.journeynode')),
                ('journey', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='edges', to='loyalty.journey')),
                ('to_node', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='incoming_edges', to='loyalty.journeynode')),
            ],
        ),
        migrations.AddField(
            model_name='journey',
            name='entry_segment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='loyalty.segment'),
        ),
        migrations.AddField(
            model_name='journey',
            name='program',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='journeys', to='loyalty.loyaltyprogram'),
        ),
        migrations.CreateModel(
            name='HoldoutGroup',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('size_percentage', models.FloatField(default=10.0, help_text='Percentage of segment')),
                ('member_ids', models.JSONField(default=list, help_text='List of customer_ids')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='holdout_groups', to='loyalty.experiment')),
            ],
        ),
        migrations.CreateModel(
            name='ExperimentAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('variant', models.CharField(max_length=50)),
                ('assigned_at', models.DateTimeField(auto_now_add=True)),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assignments', to='loyalty.experiment')),
            ],
        ),
        migrations.AddField(
            model_name='experiment',
            name='segment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='loyalty.segment'),
        ),
        migrations.CreateModel(
            name='EarnCap',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('cap_type', models.CharField(choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('monthly', 'Monthly'), ('program', 'Program Lifetime')], max_length=20)),
                ('cap_amount', models.PositiveIntegerField()),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('program', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='earn_caps', to='loyalty.loyaltyprogram')),
                ('rule', models.ForeignKey(blank=True, help_text='Specific rule cap, or null for all', null=True, on_delete=django.db.models.deletion.CASCADE, to='loyalty.loyaltyrule')),
            ],
        ),
        migrations.CreateModel(
            name='Coalition',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('shared_points', models.BooleanField(default=False, help_text='Share points across partners')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('partners', models.ManyToManyField(related_name='coalitions', to='loyalty.Partner')),
            ],
        ),
        migrations.CreateModel(
            name='CapUsage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('period_start', models.DateTimeField()),
                ('period_end', models.DateTimeField()),
                ('used_amount', models.PositiveIntegerField(default=0)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('cap', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='usage', to='loyalty.earncap')),
            ],
        ),
        migrations.CreateModel(
            name='CampaignExecution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('triggered_at', models.DateTimeField(auto_now_add=True)),
                ('delivered_at', models.DateTimeField(blank=True, null=True)),
                ('opened_at', models.DateTimeField(blank=True, null=True)),
                ('clicked_at', models.DateTimeField(blank=True, null=True)),
                ('converted_at', models.DateTimeField(blank=True, null=True)),
                ('channel', models.CharField(max_length=50)),
                ('message_id', models.CharField(blank=True, max_length=255)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('campaign', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='executions', to='loyalty.campaign')),
            ],
        ),
        migrations.AddField(
            model_name='campaign',
            name='experiment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='campaigns', to='loyalty.experiment'),
        ),
        migrations.AddField(
            model_name='campaign',
            name='parent_campaign',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='versions', to='loyalty.campaign'),
        ),
        migrations.AddField(
            model_name='campaign',
            name='program',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='campaigns', to='loyalty.loyaltyprogram'),
        ),
        migrations.AddField(
            model_name='campaign',
            name='segment',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='campaigns', to='loyalty.segment'),
        ),
        migrations.CreateModel(
            name='BadgeAward',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('customer_id', models.UUIDField(db_index=True)),
                ('awarded_at', models.DateTimeField(auto_now_add=True)),
                ('awarded_reason', models.CharField(blank=True, max_length=255)),
                ('badge', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='awards', to='loyalty.badge')),
            ],
        ),
        migrations.AddField(
            model_name='badge',
            name='program',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='badges', to='loyalty.loyaltyprogram'),
        ),
        migrations.CreateModel(
            name='ApprovalRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('resource_type', models.CharField(max_length=100)),
                ('resource_id', models.CharField(max_length=100)),
                ('requested_by', models.CharField(max_length=100)),
                ('requested_at', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('current_step', models.PositiveIntegerField(default=0)),
                ('request_data', models.JSONField(blank=True, default=dict)),
                ('workflow', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='requests', to='loyalty.approvalworkflow')),
            ],
        ),
        migrations.CreateModel(
            name='ApprovalDecision',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('decided_by', models.CharField(max_length=100)),
                ('decided_at', models.DateTimeField(auto_now_add=True)),
                ('decision', models.CharField(choices=[('approve', 'Approve'), ('reject', 'Reject')], max_length=20)),
                ('comments', models.TextField(blank=True)),
                ('request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='decisions', to='loyalty.approvalrequest')),
            ],
            options={
                'ordering': ['-decided_at'],
            },
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['user_id'], name='loyalty_use_user_id_362eae_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='userrole',
            unique_together={('user_id', 'role')},
        ),
        migrations.AddIndex(
            model_name='streak',
            index=models.Index(fields=['customer_id', 'streak_type'], name='loyalty_str_custome_f51143_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='streak',
            unique_together={('customer_id', 'program', 'streak_type')},
        ),
        migrations.AlterUniqueTogether(
            name='segmentsnapshot',
            unique_together={('segment', 'snapshot_date')},
        ),
        migrations.AddIndex(
            model_name='segmentmember',
            index=models.Index(fields=['segment', 'is_active'], name='loyalty_seg_segment_1557b2_idx'),
        ),
        migrations.AddIndex(
            model_name='segmentmember',
            index=models.Index(fields=['customer_id'], name='loyalty_seg_custome_b94b93_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='segmentmember',
            unique_together={('segment', 'customer_id', 'is_active')},
        ),
        migrations.AlterUniqueTogether(
            name='rolepermission',
            unique_together={('role', 'permission')},
        ),
        migrations.AddIndex(
            model_name='pointsexpiryevent',
            index=models.Index(fields=['account', 'expiry_date'], name='loyalty_poi_account_a3fe2d_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='partnersettlement',
            unique_together={('partner', 'program', 'period_start')},
        ),
        migrations.AlterUniqueTogether(
            name='partnerprogram',
            unique_together={('partner', 'program')},
        ),
        migrations.AddIndex(
            model_name='missionprogress',
            index=models.Index(fields=['mission', 'is_completed'], name='loyalty_mis_mission_9614e8_idx'),
        ),
        migrations.AddIndex(
            model_name='missionprogress',
            index=models.Index(fields=['customer_id'], name='loyalty_mis_custome_83022e_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='missionprogress',
            unique_together={('mission', 'customer_id')},
        ),
        migrations.AddIndex(
            model_name='leaderboardentry',
            index=models.Index(fields=['leaderboard', 'rank'], name='loyalty_lea_leaderb_c97e7d_idx'),
        ),
        migrations.AddIndex(
            model_name='leaderboardentry',
            index=models.Index(fields=['customer_id'], name='loyalty_lea_custome_31b4fe_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='leaderboardentry',
            unique_together={('leaderboard', 'customer_id', 'period_start')},
        ),
        migrations.AddIndex(
            model_name='journeyexecution',
            index=models.Index(fields=['journey', 'status'], name='loyalty_jou_journey_686758_idx'),
        ),
        migrations.AddIndex(
            model_name='journeyexecution',
            index=models.Index(fields=['customer_id'], name='loyalty_jou_custome_7495d0_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='journeyexecution',
            unique_together={('journey', 'customer_id', 'status')},
        ),
        migrations.AddIndex(
            model_name='experimentassignment',
            index=models.Index(fields=['experiment', 'variant'], name='loyalty_exp_experim_a48507_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='experimentassignment',
            unique_together={('experiment', 'customer_id')},
        ),
        migrations.AddIndex(
            model_name='capusage',
            index=models.Index(fields=['customer_id', 'period_start'], name='loyalty_cap_custome_1c97d4_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='capusage',
            unique_together={('cap', 'customer_id', 'period_start')},
        ),
        migrations.AddIndex(
            model_name='campaignexecution',
            index=models.Index(fields=['campaign', 'customer_id'], name='loyalty_cam_campaig_33b069_idx'),
        ),
        migrations.AddIndex(
            model_name='campaignexecution',
            index=models.Index(fields=['triggered_at'], name='loyalty_cam_trigger_5c8aa9_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='campaign',
            unique_together={('name', 'version')},
        ),
        migrations.AddIndex(
            model_name='badgeaward',
            index=models.Index(fields=['customer_id'], name='loyalty_bad_custome_f7e85d_idx'),
        ),
        migrations.AddIndex(
            model_name='badgeaward',
            index=models.Index(fields=['awarded_at'], name='loyalty_bad_awarded_9fb772_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='badgeaward',
            unique_together={('badge', 'customer_id')},
        ),
        migrations.AddIndex(
            model_name='approvalrequest',
            index=models.Index(fields=['resource_type', 'resource_id'], name='loyalty_app_resourc_efb7c2_idx'),
        ),
        migrations.AddIndex(
            model_name='approvalrequest',
            index=models.Index(fields=['status'], name='loyalty_app_status_9a6a0a_idx'),
        ),
    ]
